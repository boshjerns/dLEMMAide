<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Mithril AI IDE</title>
    
    <!-- CodeMirror CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/codemirror.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/theme/material-darker.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/addon/dialog/dialog.min.css">
    
    <!-- Highlight.js for chat -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/monokai.min.css" />
    
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <div class="ide-container">
      <!-- Title Bar -->
      <div class="title-bar">
        <div class="title-bar-left">
          <img src="../logoM.png" alt="Mithril" class="app-logo" />
          <span class="app-title">Mithril AI IDE</span>
        </div>
        <div class="title-bar-right">
          <button class="title-btn" id="minimize-btn">‚àí</button>
          <button class="title-btn" id="maximize-btn">‚ñ°</button>
          <button class="title-btn close" id="close-btn">√ó</button>
        </div>
      </div>

      <!-- Main IDE Layout -->
      <div class="ide-layout">
        <!-- File Tree Sidebar -->
        <div class="file-sidebar">
          <div class="sidebar-header">
            <h3>Explorer</h3>
            <div class="explorer-buttons">
              <button class="btn-new-file" id="new-file-btn" title="New File">üìÑ</button>
              <button class="btn-new-folder" id="new-folder-btn" title="New Folder">üìÅ</button>
              <button class="btn-open-folder" id="open-folder-btn" title="Open Folder">üìÇ</button>
              <button class="btn-settings" id="settings-btn" title="Settings">‚öôÔ∏è</button>
            </div>
          </div>
          <div class="file-tree" id="file-tree">
            <div class="empty-state">
              <p>No folder open</p>
              <button class="btn-primary" id="open-workspace-btn">Open Folder</button>
            </div>
          </div>
        </div>

        <!-- Main Editor Area -->
        <div class="editor-area">
          <!-- File Tabs -->
          <div class="file-tabs-bar" id="file-tabs-bar">
            <div class="tabs-container" id="tabs-container">
              <!-- Tabs will be added dynamically -->
            </div>
            <div class="tabs-actions">
              <button class="btn-tab-action" id="save-btn" title="Save File (Ctrl+S)">üíæ</button>
              <button class="btn-tab-action" id="undo-btn" title="Undo (Ctrl+Z)">‚Ü©Ô∏è</button>
              <button class="btn-tab-action" id="redo-btn" title="Redo (Ctrl+Y)">‚Ü™Ô∏è</button>
              <button class="btn-tab-action" id="history-btn" title="View History">üìö</button>
              <button class="btn-tab-action" id="find-replace-btn" title="Find & Replace">üîç</button>
              <button class="btn-tab-action" id="theme-toggle-btn" title="Toggle Theme">üé®</button>
              <button class="btn-tab-action" id="close-all-tabs" title="Close All">√ó</button>
            </div>
          </div>

          <!-- Editor Container -->
          <div class="editor-container" id="editor-container">
            <div class="editor-welcome">
              <div class="welcome-content">
                <h2>üöÄ Mithril AI IDE</h2>
                <p>Open a file or create a new one to start coding with AI assistance</p>
                <div class="welcome-actions">
                  <button class="btn-primary" id="welcome-new-file">New File</button>
                  <button class="btn-secondary" id="welcome-open-folder">Open Folder</button>
                </div>
              </div>
            </div>
          </div>

          <!-- AI Selection Overlay -->
          <div class="ai-selection-overlay" id="ai-selection-overlay" style="display: none;">
            <div class="selection-popup">
              <div class="selection-actions">
                <button class="btn-ai-action" data-action="explain">Explain</button>
                <button class="btn-ai-action" data-action="refactor">Refactor</button>
                <button class="btn-ai-action" data-action="fix">Fix Issues</button>
                <button class="btn-ai-action" data-action="optimize">Optimize</button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Embedded Chat Interface -->
      <div class="chat-interface">
        <div class="chat-resize-handle" id="chat-resize-handle" title="Drag to resize chat">
          <div class="resize-grip"></div>
        </div>
        <div class="chat-header">
          <div class="chat-title">
            <span class="chat-icon">ü§ñ</span>
            <span>AI Assistant</span>
          </div>
          <div class="chat-model-selector">
            <label for="model-selector">Model:</label>
            <select id="model-selector" class="model-dropdown">
              <option value="">Loading models...</option>
            </select>
          </div>
          <div class="chat-context-indicator" style="display: none;"></div>
          <div class="chat-controls">
            <button class="btn-chat-action" id="refresh-models" title="Refresh Models">üîÑ</button>
            <button class="btn-chat-action" id="clear-chat">Clear</button>
            <button class="btn-chat-action" id="clear-chunks" title="Clear Code Chunks" onclick="window.mithrilIDE?.clearAllChatCodeChunks?.()">üóëÔ∏è</button>
            <button class="btn-chat-action auto-replace-toggle" id="auto-replace-toggle" title="Toggle Auto Code Replacement" onclick="window.mithrilIDE?.toggleAutoReplace?.()">üîß</button>
            <button class="btn-chat-action" id="toggle-chat">‚àí</button>
          </div>
        </div>
        
        <div class="chat-messages" id="chat-messages">
          <div class="welcome-message">
            <div class="ai-avatar">ü§ñ</div>
            <div class="message-content">
              <p>Hi! I'm your AI coding assistant. Select code to analyze it, or ask me anything about your project.</p>
            </div>
          </div>
        </div>
        
        <!-- Code Chunks Area (above chat input) -->
        <div class="chat-code-chunks" id="chat-code-chunks" style="display: none;">
          <div class="chunks-header">
            <span class="chunks-label">Code Context:</span>
            <button class="chunks-clear" onclick="window.mithrilIDE?.clearAllChatCodeChunks?.()" title="Clear all chunks">Clear All</button>
          </div>
          <div class="chunks-container" id="chunks-container">
            <!-- Code chunk cards will be added here -->
          </div>
        </div>
        
        <div class="chat-input-area">
          <div class="input-container">
            <textarea 
              id="chat-input" 
              placeholder="Ask about your code, request changes, or get help..."
              rows="1"
            ></textarea>
            <button class="btn-send" id="send-btn">
              <span class="send-icon">‚û§</span>
            </button>
          </div>
          <div class="input-hints">
            <span class="hint">üí° Select code for context-aware assistance</span>
          </div>
        </div>
      </div>



      <!-- Settings Modal -->
      <div class="settings-modal" id="settings-modal" style="display: none;">
        <div class="settings-content">
          <div class="settings-header">
            <h2>‚öôÔ∏è IDE Settings</h2>
            <button class="settings-close" id="settings-close">&times;</button>
          </div>
          <div class="settings-body">
            <div class="settings-group">
              <label>Editor Theme:</label>
              <select id="theme-selector">
                <option value="material-darker">Material Darker</option>
                <option value="monokai">Monokai</option>
                <option value="dracula">Dracula</option>
                <option value="solarized dark">Solarized Dark</option>
                <option value="base16-dark">Base16 Dark</option>
                <option value="default">Light Theme</option>
              </select>
            </div>
            <div class="settings-group">
              <label>Font Size:</label>
              <select id="font-size-selector">
                <option value="12">12px</option>
                <option value="14" selected>14px</option>
                <option value="16">16px</option>
                <option value="18">18px</option>
                <option value="20">20px</option>
              </select>
            </div>
            <div class="settings-group">
              <label>Tab Size:</label>
              <select id="tab-size-selector">
                <option value="2" selected>2 spaces</option>
                <option value="4">4 spaces</option>
                <option value="8">8 spaces</option>
              </select>
            </div>
            <div class="settings-group">
              <label><input type="checkbox" id="line-numbers-toggle" checked> Show Line Numbers</label>
            </div>
            <div class="settings-group">
              <label><input type="checkbox" id="word-wrap-toggle" checked> Word Wrap</label>
            </div>
            <div class="settings-group">
              <label><input type="checkbox" id="auto-close-brackets-toggle" checked> Auto Close Brackets</label>
            </div>
          </div>
        </div>
      </div>

      <!-- Find & Replace Panel -->
      <div class="find-replace-panel" id="find-replace-panel" style="display: none;">
        <div class="find-replace-content">
          <div class="find-section">
            <input type="text" id="find-input" placeholder="Find..." />
            <button id="find-prev-btn">‚Üë</button>
            <button id="find-next-btn">‚Üì</button>
            <button id="find-close-btn">&times;</button>
          </div>
          <div class="replace-section">
            <input type="text" id="replace-input" placeholder="Replace..." />
            <button id="replace-btn">Replace</button>
            <button id="replace-all-btn">Replace All</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Scripts -->
    <!-- CodeMirror Core -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/codemirror.min.js"></script>
    
    <!-- CodeMirror Language Modes -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/mode/javascript/javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/mode/python/python.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/mode/htmlmixed/htmlmixed.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/mode/css/css.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/mode/xml/xml.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/mode/markdown/markdown.min.js"></script>
    
    <!-- CodeMirror Addons -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/addon/edit/closebrackets.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/addon/edit/matchbrackets.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/addon/selection/active-line.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/addon/search/search.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/addon/search/searchcursor.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/addon/dialog/dialog.min.js"></script>
    
    <!-- Highlight.js for chat -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/12.0.2/marked.min.js"></script>
    
    <!-- App Scripts -->
    <script src="cli-tools.js"></script>
    <script src="ide-ai-manager.js"></script>
    <script src="ide-core.js"></script>
  </body>
</html> 